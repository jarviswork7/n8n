import json\nimport boto3\n\ndef lambda_handler(event, context):\n    ec2 = boto3.client('ec2')\n    try:\n        instances = ec2.describe_instances()\n        instance_details = []\n        for reservation in instances['Reservations']:  \n            for instance in reservation['Instances']:  \n                instance_details.append({\n                    'InstanceId': instance['InstanceId'],\n                    'State': instance['State']['Name'],\n                    'PublicIpAddress': instance.get('PublicIpAddress', 'N/A')\n                })\n        return {\n            'statusCode': 200,\n            'body': json.dumps(instance_details)\n        }\n    except Exception as e:\n        return {\n            'statusCode': 500,\n            'body': json.dumps({'Error': str(e)})\n        }